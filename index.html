<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dum-machine | 360 Solutions</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            background: #121212; 
            color: #e0e0e0; 
            text-align: center; 
            margin: 0;
            padding: 20px;
            touch-action: manipulation;
        }
        h1 { color: #00ffcc; margin-bottom: 5px; }
        .subtitle { font-size: 0.9em; color: #888; margin-bottom: 20px; }
        
        .grid { 
            display: grid; 
            grid-template-columns: repeat(16, 1fr); 
            gap: 4px; 
            max-width: 100%; 
            margin: 20px auto; 
            background: #1e1e1e;
            padding: 10px;
            border-radius: 8px;
            overflow-x: auto;
        }
        
        .row-label { 
            grid-column: span 16; 
            text-align: left; 
            margin-top: 15px; 
            font-size: 0.75em; 
            font-weight: bold;
            text-transform: uppercase;
            color: #00ffcc;
        }

        .node { 
            width: 100%; 
            aspect-ratio: 1; 
            background: #333; 
            border: 1px solid #444; 
            border-radius: 3px; 
        }
        
        /* Highlight every 4th beat to help the eyes */
        .node:nth-child(4n+1):not(.row-label) {
            border-color: #666;
        }

        .node.active { 
            background: #00ffcc; 
            box-shadow: 0 0 10px #00ffcc;
        }

        .controls { 
            margin-top: 30px; 
            padding: 20px;
            background: #1e1e1e;
            border-radius: 15px;
        }

        button { 
            padding: 15px 40px; 
            font-size: 1.1em; 
            font-weight: bold;
            border-radius: 50px; 
            border: none; 
            background: #00ffcc; 
            color: #121212;
            cursor: pointer; 
            width: 100%;
            max-width: 250px;
        }

        input[type=range] {
            width: 100%;
            margin: 20px 0;
        }

        .bpm-display { font-size: 1.2em; font-weight: bold; }
    </style>
</head>
<body>

    <h1>Dum-machine</h1>
    <div class="subtitle">360 Solutions Vibe Lab</div>

    <div id="sequencer" class="grid"></div>

    <div class="controls">
        <button id="playBtn">START / STOP</button>
        <div style="margin-top: 20px;">
            <span class="bpm-display" id="bpm">120</span> BPM
            <input type="range" id="tempo" min="60" max="180" value="120">
        </div>
    </div>

    <script>
        const sequencer = document.getElementById('sequencer');
        const sounds = ['Kick', 'Snare', 'Hi-Hat', 'Open-HH'];
        let isPlaying = false;
        let tempo = 120;
        let currentStep = 0;

        // Create the UI Grid
        sounds.forEach(sound => {
            const label = document.createElement('div');
            label.className = 'row-label';
            label.innerText = sound;
            sequencer.appendChild(label);
            
            for (let i = 0; i < 16; i++) {
                const btn = document.createElement('div');
                btn.className = 'node';
                // This lets you toggle notes on/off
                btn.onclick = () => btn.classList.toggle('active');
                sequencer.appendChild(btn);
            }
        });

        // Initialize Audio Context
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const ctx = new AudioContext();

        // Simple synth "beep" to test the timing
        function playNote() {
            const osc = ctx.createOscillator();
            const envelope = ctx.createGain();

            osc.type = 'sine';
            envelope.gain.setValueAtTime(0.1, ctx.currentTime);
            envelope.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.1);

            osc.connect(envelope);
            envelope.connect(ctx.destination);

            osc.start();
            osc.stop(ctx.currentTime + 0.1);
        }

        function runSequencer() {
            if (!isPlaying) return;

            // Simple loop timing logic
            // In a future version, we will use precise Web Audio clocks
            playNote(); 
            
            setTimeout(runSequencer, (60000 / tempo) / 4);
        }

        document.getElementById('playBtn').onclick = () => {
            if (ctx.state === 'suspended') ctx.resume();
            
            isPlaying = !isPlaying;
            if (isPlaying) {
                document.getElementById('playBtn').style.background = '#ff4444';
                runSequencer();
            } else {
                document.getElementById('playBtn').style.background = '#00ffcc';
            }
        };

        document.getElementById('tempo').oninput = (e) => {
            tempo = e.target.value;
            document.getElementById('bpm').innerText = tempo;
        };
    </script>
</body>
</html>
